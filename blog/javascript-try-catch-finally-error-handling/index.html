<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style id="typography.js">html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block}audio:not([controls]){display:none;height:0}progress{vertical-align:baseline}[hidden],template{display:none}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}dfn{font-style:italic}h1{font-size:2em;margin:.67em 0}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}img{border-style:none}svg:not(:root){overflow:hidden}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}figure{margin:1em 40px}hr{box-sizing:content-box;height:0;overflow:visible}button,input,optgroup,select,textarea{font:inherit;margin:0}optgroup{font-weight:700}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-input-placeholder{color:inherit;opacity:.54}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}html{font:112.5%/1.75 'Atkinson Hyperlegible';box-sizing:border-box;overflow-y:scroll;}*{box-sizing:inherit;}*:before{box-sizing:inherit;}*:after{box-sizing:inherit;}body{color:hsla(0,0%,0%,0.8);font-family:'Atkinson Hyperlegible';font-weight:normal;word-wrap:break-word;font-kerning:normal;-moz-font-feature-settings:"kern", "liga", "clig", "calt";-ms-font-feature-settings:"kern", "liga", "clig", "calt";-webkit-font-feature-settings:"kern", "liga", "clig", "calt";font-feature-settings:"kern", "liga", "clig", "calt";}img{max-width:100%;margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}h1{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Atkinson Hyperlegible';font-weight:bold;text-rendering:optimizeLegibility;font-size:2rem;line-height:1.1;}h2{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Atkinson Hyperlegible';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.51572rem;line-height:1.1;}h3{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Atkinson Hyperlegible';font-weight:bold;text-rendering:optimizeLegibility;font-size:1.31951rem;line-height:1.1;}h4{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Atkinson Hyperlegible';font-weight:bold;text-rendering:optimizeLegibility;font-size:1rem;line-height:1.1;}h5{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Atkinson Hyperlegible';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.87055rem;line-height:1.1;}h6{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;color:inherit;font-family:'Atkinson Hyperlegible';font-weight:bold;text-rendering:optimizeLegibility;font-size:0.81225rem;line-height:1.1;}hgroup{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}ul{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}ol{margin-left:1.75rem;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;list-style-position:outside;list-style-image:none;}dl{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}dd{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}p{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}figure{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}pre{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:0.85rem;line-height:1.75rem;}table{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-size:1rem;line-height:1.75rem;border-collapse:collapse;width:100%;}fieldset{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}blockquote{margin-left:0rem;margin-right:1.75rem;margin-top:0;padding-bottom:0;padding-left:0.875rem;padding-right:0;padding-top:0;margin-bottom:1.75rem;font-style:italic;border-left:0.4375rem solid hsla(0,0%,0%,0.8);}form{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}noscript{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}iframe{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}hr{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:calc(1.75rem - 1px);background:hsla(0,0%,0%,0.2);border:none;height:1px;}address{margin-left:0;margin-right:0;margin-top:0;padding-bottom:0;padding-left:0;padding-right:0;padding-top:0;margin-bottom:1.75rem;}b{font-weight:bold;}strong{font-weight:bold;}dt{font-weight:bold;}th{font-weight:bold;}li{margin-bottom:calc(1.75rem / 2);}ol li{padding-left:0;}ul li{padding-left:0;}li > ol{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}li > ul{margin-left:1.75rem;margin-bottom:calc(1.75rem / 2);margin-top:calc(1.75rem / 2);}blockquote *:last-child{margin-bottom:0;}li *:last-child{margin-bottom:0;}p *:last-child{margin-bottom:0;}li > p{margin-bottom:calc(1.75rem / 2);}code{font-size:0.85rem;line-height:1.75rem;}kbd{font-size:0.85rem;line-height:1.75rem;}samp{font-size:0.85rem;line-height:1.75rem;}abbr{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}acronym{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;}abbr[title]{border-bottom:1px dotted hsla(0,0%,0%,0.5);cursor:help;text-decoration:none;}thead{text-align:left;}td,th{text-align:left;border-bottom:1px solid hsla(0,0%,0%,0.12);font-feature-settings:"tnum";-moz-font-feature-settings:"tnum";-ms-font-feature-settings:"tnum";-webkit-font-feature-settings:"tnum";padding-left:1.16667rem;padding-right:1.16667rem;padding-top:0.875rem;padding-bottom:calc(0.875rem - 1px);}th:first-child,td:first-child{padding-left:0;}th:last-child,td:last-child{padding-right:0;}</style><style data-href="/styles.47922f7397924f0fa8f2.css" id="gatsby-global-css">pre::-webkit-scrollbar{height:15px;cursor:pointer}pre::-webkit-scrollbar-thumb{background:grey}pre code::-webkit-scrollbar-track-piece{background:none}pre[class*=language-]:after{display:block;position:absolute;top:0;left:0;background:#1a73e8;color:#fff;padding:.1em .3em}div.gatsby-highlight>pre.language-meta{padding:1em}pre.language-meta:after{display:none}pre.language-javascript:after{content:"javascript"}pre.language-jsx:after{content:"jsx"}pre.language-css:after{content:"css"}pre.language-html:after{content:"html"}pre.language-json:after{content:"json"}pre.language-console:after{content:"console"}pre.language-bash:after{content:"bash"}pre.language-plantumlcode:after{content:"plantumlcode"}code[class*=language-],pre[class*=language-]{text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;color:#eee;background:#2f2f2f;font-family:Menlo,Roboto Mono,monospace;line-height:1.5em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{background:#363636}:not(pre)>code[class*=language-]{white-space:normal;border-radius:.2em;padding:.3em .4em}pre[class*=language-]{overflow:auto;position:relative;margin:.5em 0;padding:3em 1em 1.25em}.language-css>code,.language-sass>code,.language-scss>code{color:#fd9170}[class*=language-] .namespace{opacity:.7}.token.atrule{color:#c792ea}.token.attr-name{color:#ffcb6b}.token.attr-value,.token.attribute{color:#a5e844}.token.boolean{color:#c792ea}.token.builtin{color:#ffcb6b}.token.cdata,.token.char{color:#80cbc4}.token.class{color:#ffcb6b}.token.class-name{color:#f2ff00}.token.comment{color:#616161}.token.constant{color:#c792ea}.token.deleted{color:#f66}.token.doctype{color:#616161}.token.entity{color:#f66}.token.function{color:#c792ea}.token.hexcode{color:#f2ff00}.token.id,.token.important{color:#c792ea;font-weight:700}.token.inserted{color:#80cbc4}.token.keyword{color:#c792ea}.token.number{color:#fd9170}.token.operator{color:#89ddff}.token.prolog{color:#616161}.token.property{color:#80cbc4}.token.pseudo-class,.token.pseudo-element{color:#a5e844}.token.punctuation{color:#89ddff}.token.regex{color:#f2ff00}.token.selector{color:#f66}.token.string{color:#a5e844}.token.symbol{color:#c792ea}.token.tag{color:#f66}.token.unit{color:#fd9170}.token.url,.token.variable{color:#f66}h1{font-size:1.75rem}a{text-decoration:none;color:#1a73e8;border-bottom:3px solid #1a73e8}li{margin-bottom:0}li :last-child{margin-bottom:1.5rem}.gatsby-highlight{box-shadow:5px 5px #1a73e8;margin-bottom:1.75rem}</style><meta name="generator" content="Gatsby 2.32.12"/><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/rss.xml"/><link rel="icon" href="/favicon-32x32.png?v=f6c52ce3c692eb61055427d9e84acf18" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="anonymous"/><meta name="theme-color" content="#1a73e8"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png?v=f6c52ce3c692eb61055427d9e84acf18"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png?v=f6c52ce3c692eb61055427d9e84acf18"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png?v=f6c52ce3c692eb61055427d9e84acf18"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png?v=f6c52ce3c692eb61055427d9e84acf18"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png?v=f6c52ce3c692eb61055427d9e84acf18"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png?v=f6c52ce3c692eb61055427d9e84acf18"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png?v=f6c52ce3c692eb61055427d9e84acf18"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png?v=f6c52ce3c692eb61055427d9e84acf18"/><title data-react-helmet="true">JavaScript try/catch/finally error handling | uxdx.dev</title><meta data-react-helmet="true" name="description" content="I recently encountered a bug that used try/catch blocks to prevent propagating errors when DOM queries failed. The try/catch/finally combo is not exactly intuitive."/><meta data-react-helmet="true" property="og:title" content="JavaScript try/catch/finally error handling"/><meta data-react-helmet="true" property="og:description" content="I recently encountered a bug that used try/catch blocks to prevent propagating errors when DOM queries failed. The try/catch/finally combo is not exactly intuitive."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" property="og:image" content="https://uxdx.dev/static/d37abe98f6b1a922370bbc542cc75bc3/94285/banner.jpg"/><meta data-react-helmet="true" name="author" content="Daithi Morton"/><meta data-react-helmet="true" name="keywords" content="blog,software,javascript,ux,dx,product development,tutorials,learning,teaching,error handling,try,catch,finally"/><link href="//fonts.googleapis.com/css?family=Atkinson+Hyperlegible:400,500,700" rel="stylesheet" type="text/css"/><link as="script" rel="preload" href="/webpack-runtime-7bf8aac40dc11a90f17f.js"/><link as="script" rel="preload" href="/framework-8e528b732ab2eaadb7b7.js"/><link as="script" rel="preload" href="/styles-755093da0c07f4b49226.js"/><link as="script" rel="preload" href="/app-515c1d2f645bea33d60b.js"/><link as="script" rel="preload" href="/b79069689330af6ebec416d0224ba4ba1c9f1d46-54feeece3a0d49a7f66e.js"/><link as="script" rel="preload" href="/efb843684f5d054a3f031beebf163da3acfe6ec8-4c9ed97c0d4c26600394.js"/><link as="script" rel="preload" href="/component---src-templates-post-template-js-bae8dc2dc1ce16295dd3.js"/><link as="fetch" rel="preload" href="/page-data/blog/javascript-try-catch-finally-error-handling/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3128451518.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/3965681216.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/4196972762.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><header style="margin-left:auto;margin-right:auto;max-width:28rem;padding:0.875rem;display:flex;align-items:center"><div style="width:100%"><div style="display:flex;align-items:center"><div style="display:flex;flex-direction:column;margin-right:auto"><a style="text-decoration:none;color:inherit;border-bottom:none" href="/"><h1 style="margin-bottom:5px">David Morton</h1>Software engineer</a><div><a rel="noreferrer noopener" href="https://github.com/uxdxdev" target="_blank" style="margin:0 2px 0 2px">GitHub</a> <a rel="noreferrer noopener" href="https://www.linkedin.com/in/uxdx/" target="_blank" style="margin:0 2px 0 2px">LinkedIn</a> <a rel="noreferrer noopener" href="https://www.npmjs.com/~uxdx" target="_blank" style="margin:0 2px 0 2px">NPM</a> <a rel="noreferrer noopener" href="/jsenv" target="_blank" style="margin:0 2px 0 2px">JSEnv</a> <a rel="noreferrer noopener" href="/codingpractice" target="_blank" style="margin:0 2px 0 2px">Coding Practice</a> <a rel="noreferrer noopener" href="https://bit.ly/david-morton-resume" target="_blank" style="margin:0 2px 0 2px">Résumé</a> </div></div><a style="text-decoration:none;color:inherit;border-bottom:none" href="/"><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden;display:inline-block;width:120px;height:120px;min-width:120px;border-radius:100%"><img aria-hidden="true" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAEEElEQVQ4y32Ua0zTZxTG+2XJYkx2zZItM0yyS5ii2xQh2wKZG1mCEmBYESqOQhHmFKJymdhyGRcZ6Ax3rIql0HLZshCWyhRkBJgQdCLlOi5bM74gWxC3YBxr+9vbfwGrkH3457zte87znvOc5xwZQzUsf/ZB/crZZq6GiUaYbICxWnE2YhP3NrN+xdc+KKxLvOOTrQIUTo5AfjEwfbWS2sJsStI1XK89C6MGCdw6UL0EtAQ6uAag88WlDARY24VCtvtF4O4t53UfOZ7vhqE+moql9SJMNUoVLAO5ViZzBZMuhmu436cjQh7Hs1t38dKOINx8QtjxQTge3nsICYzjp7pzMF4vVfI4qMz1h3VA2Ekj483lvLo9lKff9GeTTyBbfILY6BXEy17BvPDWbrx8FZjOnXbyatavztAV1OGQfiwJZYSSnvNZzJgKGas6SevJKKoORyIPiub5twN5zfsTbnxTJDI1PAK6kqHV0dWpek5nncDDJ5S/uirAIjo8Ijo8buSfrmLGcsO5nRlNjFyJbIMvFbkaEVPnbNLjgFIzRGCayC7jYILEpW2olof3Ncw252L5+gC6I/tx2xZK+6VCiSLrWhlKgJN1ZKSkUpCULPGz0KPlfq/WeTeiZ/ZaKbfzVVz7Yi9b39vLzcZiyc9qXqPLjrSx1FMmylAnHYOOAkoPx6NNiIfeYn6++CWfy6Mp/0zFlVQFwSFK7vVWiYdq1m6Ks2QDU5crMBXnY+spxph5nJasQ0LsF7h6Kpm8aCXfHVfQof4UXU6GJHKbq+QeZrikdsHbg/5ahurOSC8zWI3tplZYHaNF8dzKimSuIZUuTSQdpekS56tlI42bXhol+4BOcPItf7aWstBdJkbNiH3EKMANTJTE0acOY1LYlhMqpk1F0kTZ/0+H9iERfKePP/qvMNdZKQKMLPaUMG1Moy3zEF3qSMzpobTlJ7M4aFyaZf3ay8Fu1mG3tMP8BAu/9WExlTFvysFcEIP5KyX6xDh+SFPRkRpOe2XeI+WuPcvDoryZfmyzwwJ0jLaqMtpSwrHdqORu21nMOQo6RTNiw1SMXi53NsRlla0AStwJ8u0jDVhnBlicHYMHv3K3v5kzsQeZ1KuZ0SdzS6Pg6L5YMo4I0U87J+hfITXXpjiszCFKaf8J4rnTCXO9dDdp6W4sZL5TS5HQYoI8gl0BUcTtieL7NCWNJdncu14ljSpjhqXRXZaN4MKxOP/uu0SL7hTRKhXPbfHnmc3+5KUn0aTNQZOYQJw8jIrEA/j6BSBz34nn+yEUZqTw+4+VznmfqHNmWJ6tYX9MPJ5+oTz5xkfIXvFjvVhb6zzE2c2X9Zv8cffZzYZ3Pmad+P8J4fPUZofdiWyjHy9uC+DDYAVN53OlxP4DdSe6PMtn7C4AAAAASUVORK5CYII=" alt="David Morton" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms;margin-bottom:0;border-radius:50%"/><noscript><picture><source srcset="/static/f6c52ce3c692eb61055427d9e84acf18/35de9/profile_cropped.png 1x,
/static/f6c52ce3c692eb61055427d9e84acf18/91983/profile_cropped.png 1.5x,
/static/f6c52ce3c692eb61055427d9e84acf18/ed1d1/profile_cropped.png 2x" /><img loading="lazy" width="120" height="120" srcset="/static/f6c52ce3c692eb61055427d9e84acf18/35de9/profile_cropped.png 1x,
/static/f6c52ce3c692eb61055427d9e84acf18/91983/profile_cropped.png 1.5x,
/static/f6c52ce3c692eb61055427d9e84acf18/ed1d1/profile_cropped.png 2x" src="/static/f6c52ce3c692eb61055427d9e84acf18/35de9/profile_cropped.png" alt="David Morton" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div></a></div></div></header><div style="margin:1.75rem auto;max-width:52.5rem;padding:0.875rem"><div style="text-align:center"><h2>JavaScript try/catch/finally error handling</h2><p style="display:block;margin-bottom:1.75rem;margin-top:-0.875rem">☕ <!-- -->5<!-- --> min read</p></div><div><div class=" gatsby-image-wrapper" style="position:relative;overflow:hidden"><div aria-hidden="true" style="width:100%;padding-bottom:74.44444444444444%"></div><img aria-hidden="true" src="data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAMEAgX/xAAVAQEBAAAAAAAAAAAAAAAAAAACA//aAAwDAQACEAMQAAAB4lU7BRBoQ//EABkQAAIDAQAAAAAAAAAAAAAAAAECAAMREv/aAAgBAQABBQIDS9BWEZEfg2Wlhs//xAAXEQADAQAAAAAAAAAAAAAAAAAAARES/9oACAEDAQE/AVmEP//EABcRAAMBAAAAAAAAAAAAAAAAAAEQERL/2gAIAQIBAT8BOqv/xAAWEAEBAQAAAAAAAAAAAAAAAAAQEQH/2gAIAQEABj8CmNf/xAAaEAEAAwADAAAAAAAAAAAAAAABABEhQWGB/9oACAEBAAE/Ia7RYAJaPMRUkagWwEPuzVdT/9oADAMBAAIAAwAAABC4P//EABgRAQEAAwAAAAAAAAAAAAAAAAEAITFB/9oACAEDAQE/EBldyON//8QAFxEBAQEBAAAAAAAAAAAAAAAAAQAxQf/aAAgBAgEBPxBYZC9v/8QAGhABAQEBAQEBAAAAAAAAAAAAAREAITFBUf/aAAgBAQABPxB6xUAMUCUEQWXv5lKBMyGpBXwwNp2jw8hzLFfE3//Z" alt="wood fire at night on beach" style="position:absolute;top:0;left:0;width:100%;height:100%;object-fit:cover;object-position:center;opacity:1;transition-delay:500ms"/><noscript><picture><source srcset="/static/d37abe98f6b1a922370bbc542cc75bc3/49df2/banner.jpg 180w,
/static/d37abe98f6b1a922370bbc542cc75bc3/6580d/banner.jpg 360w,
/static/d37abe98f6b1a922370bbc542cc75bc3/94285/banner.jpg 720w,
/static/d37abe98f6b1a922370bbc542cc75bc3/1920d/banner.jpg 1080w,
/static/d37abe98f6b1a922370bbc542cc75bc3/c4b07/banner.jpg 1440w,
/static/d37abe98f6b1a922370bbc542cc75bc3/097fa/banner.jpg 1920w" sizes="(max-width: 720px) 100vw, 720px" /><img loading="lazy" sizes="(max-width: 720px) 100vw, 720px" srcset="/static/d37abe98f6b1a922370bbc542cc75bc3/49df2/banner.jpg 180w,
/static/d37abe98f6b1a922370bbc542cc75bc3/6580d/banner.jpg 360w,
/static/d37abe98f6b1a922370bbc542cc75bc3/94285/banner.jpg 720w,
/static/d37abe98f6b1a922370bbc542cc75bc3/1920d/banner.jpg 1080w,
/static/d37abe98f6b1a922370bbc542cc75bc3/c4b07/banner.jpg 1440w,
/static/d37abe98f6b1a922370bbc542cc75bc3/097fa/banner.jpg 1920w" src="/static/d37abe98f6b1a922370bbc542cc75bc3/94285/banner.jpg" alt="wood fire at night on beach" style="position:absolute;top:0;left:0;opacity:1;width:100%;height:100%;object-fit:cover;object-position:center"/></picture></noscript></div><a rel="noreferrer noopener" href="https://unsplash.com/photos/HJDdrWtlkIY" target="_blank" style="margin:0 2px 0 2px">Photo by Hans Isaacson</a></div><br/><blockquote><p>I recently encountered a bug that used try/catch blocks to prevent propagating errors when DOM queries failed. The try/catch/finally combo is not exactly intuitive.</p></blockquote><p>In this post I’ll talk about a bug I encountered after a components HTML structure was refactored but the underlining JavaScript logic was not. The existing code used a single try/catch block to find an element in the DOM, and if not found would try an alternative location for the element being targeted. If the first query of the DOM failed the error was caught, but subsequent queries also caused errors and were not handled correctly.</p><h2>The component</h2><p>The component in question is called a “multiple search page popup” which is a combination of a dropdown and a link, in this case the search icon is the link.</p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1226px">
      <a class="gatsby-resp-image-link" href="/static/28ee873817dda245ad3f4079f8a94915/e9140/multiple-search-page-popup.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:25.625000000000004%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQY04WQ6wrCMAyF9/4vKP4Ygm6K6Nq53i/rMYkXRAQLH0lDkpOkq3WFsQ7OB8SUEOMD5wK898g5owFCXVdY62Gdl9yUsuT6EBFCoH9CV2vF+aJwnWZJ5OaGiuabhVKaYg6NmhZrUHLBYTwLel4ox4hVeoHWM4wx6FpjbcgM7L/AOwokNcHveuQYsdsfMVDDicQuVx5Ei59JjF+30hp/eQrwmpttLwzjCeORIMs+n4cmeUz4Kvz0v2lPW0r5CZ+O6+//LIS3QAMovQAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Multiple search page popup" title="Multiple search page popup" src="/static/28ee873817dda245ad3f4079f8a94915/e9140/multiple-search-page-popup.png" srcSet="/static/28ee873817dda245ad3f4079f8a94915/72799/multiple-search-page-popup.png 320w,/static/28ee873817dda245ad3f4079f8a94915/6af66/multiple-search-page-popup.png 640w,/static/28ee873817dda245ad3f4079f8a94915/e9140/multiple-search-page-popup.png 1226w" sizes="(max-width: 1226px) 100vw, 1226px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span>
<em>Multiple search page popup component</em></p><p>When the user selects an option from the dropdown and then clicks the search icon we use JavaScript to find the selected option and use it to open a specific popup page. There are as many different popup pages as there are options in the dropdown, and popup pages allow the user to search for specific information.</p><p>The bug appeared when some refactoring was done to use a “list box” component or a “select” element for the dropdown depending on some page context data. For example we went from using only a “select” element for all instances of the “multiple search page popup” component to using a “select” element or a “list box” component.</p><div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>select</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CP1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Person<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>option</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CP2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Employer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>option</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>select</span><span class="token punctuation">&gt;</span></span></code></pre></div><p><em>A select element with options for the dropdown</em></p><div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CP1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Person<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CP2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Employer<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre></div><p><em>A list box component using multiple div elements as options in the dropdown</em></p><blockquote><p>I’m not going to go into why this decision was made because it does not help us understand error handling in this example. But at this point you should understand that we now use two different HTML structures depending on the page context. And both versions of this component look identical to the user.</p></blockquote><p>With this change in the HTML structure the JavaScript logic for finding the selected option is now fragmented, the old code searched in a single DOM location to grab the selected option from the select dropdown, but now we must search in another DOM location if it was not already found.</p><h2>The bug 🐛</h2><p>I’ve re-created the “multiple search page popup” component HTML structure in a very basic example. This is the new version that will be used on some pages of the application, alongside the old version. And should help to illustrate the bug I encountered.</p><div class="gatsby-highlight" data-language="html"><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CP1<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-box-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CP1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Person (CP1)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>list-box-item<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>CP2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Employer (CP2)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>link<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Open popup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span></code></pre></div><p><em>New variant of the multiple search page popup component using a list box</em></p><p><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:651px">
      <a class="gatsby-resp-image-link" href="/static/3316842cf58470b786923bd17fc91d34/1ac66/multiple-search-page-popup-recreation.png" style="display:block" target="_blank" rel="noopener">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:28.750000000000004%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAkUlEQVQY052RQQrEIAxFe/9D9AJddVdG6KKVmjOICOLardBF/NUBOzJIF/3wIIkaf8iArJQSqkrMzF9K3OY96tt6d2gLMUa8UWvoblh+E2LBun5AdMAYA2stnHPw3ncpZyGEvkPmhHk+MI4Lpklg3zcoRRnVhYggpYTW+r/hz/J5AmXqbPb9yDltinzztIinpVxi6M1lcJbDjAAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Multiple search page popup recreated" title="Multiple search page popup recreated" src="/static/3316842cf58470b786923bd17fc91d34/1ac66/multiple-search-page-popup-recreation.png" srcSet="/static/3316842cf58470b786923bd17fc91d34/72799/multiple-search-page-popup-recreation.png 320w,/static/3316842cf58470b786923bd17fc91d34/6af66/multiple-search-page-popup-recreation.png 640w,/static/3316842cf58470b786923bd17fc91d34/1ac66/multiple-search-page-popup-recreation.png 651w" sizes="(max-width: 651px) 100vw, 651px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span>
<em>Multiple search page popup component rendered in the browser</em></p><p>In the above code snippet and image you can see the newest version of the “multiple search page popup” component. I’ve omitted some styling to hide the options <code class="language-text">Person</code> and <code class="language-text">Employer</code> behind a dropdown menu. And the “Open popup” link represents the search icon.</p><p>The <code class="language-text">input</code> element shows the value associated with the users selection from the “dropdown”, in this case the user selected <code class="language-text">Employer</code> which has a value of <code class="language-text">CP2</code>. Now when the “Open popup” link is clicked this value of <code class="language-text">CP2</code> is used to select the popup page to be rendered.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&#x27;#list-box-item&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">item</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  item<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode<span class="token punctuation">.</span>parentNode
    <span class="token keyword">const</span> hiddenInputElement <span class="token operator">=</span> container<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    hiddenInputElement<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">&#x27;value&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p>This is an example of the code used to interact with the list box component. You may have some suggestions for improvements, but for now this is what we have to work with.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#link&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode
  <span class="token comment">// find the selected option</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// location 1</span>
    <span class="token keyword">const</span> selectElement <span class="token operator">=</span> container<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    value <span class="token operator">=</span> selectElement<span class="token punctuation">.</span>options<span class="token punctuation">[</span>selectElement<span class="token punctuation">.</span>selectedIndex<span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// location 2</span>
    <span class="token keyword">const</span> selectElement <span class="token operator">=</span> container<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    value <span class="token operator">=</span> selectElement<span class="token punctuation">.</span>options<span class="token punctuation">[</span>selectElement<span class="token punctuation">.</span>selectedIndex<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p><em>Multiple search popup component logic (old)</em></p><p>And this is the old JavaScript logic that closely resembles where the bug was found. It searches in two different locations expecting a <code class="language-text">select</code> element in both cases.</p><p>This code was designed to work with the original version of our “multiple search popup component” and will not search for the selected option in our new component variant that uses a “list box” component so we need to update it.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#link&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode
  <span class="token comment">// find the selected option</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// location 1</span>
    <span class="token keyword">const</span> selectElement <span class="token operator">=</span> container<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    value <span class="token operator">=</span> selectElement<span class="token punctuation">.</span>options<span class="token punctuation">[</span>selectElement<span class="token punctuation">.</span>selectedIndex<span class="token punctuation">]</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// location 2</span>
    <span class="token keyword">const</span> selectElement <span class="token operator">=</span> container<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
    value <span class="token operator">=</span> selectElement<span class="token punctuation">.</span>options<span class="token punctuation">[</span>selectElement<span class="token punctuation">.</span>selectedIndex<span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// location 3</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> hiddenInputElement <span class="token operator">=</span> container<span class="token punctuation">.</span>firstElementChild
    value <span class="token operator">=</span> hiddenInputElement<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p><em>Multiple search popup component logic (new)</em></p><p>This was the first change I made and tested. We added a new location to search, <code class="language-text">location 3</code>, the first child of the container. This should grab our <code class="language-text">input</code> element in our “list box” component to find the selected option value if the first two searches fail.</p><p>But this code does not work, because in our <code class="language-text">catch</code> block we look in <code class="language-text">location 2</code> and if the element is not found an error is thrown. This stops function execution so we never get to search in our new location, <code class="language-text">location 3</code>. This sent me down the try/catch/finally error handling rabbit hole.</p><h2>Error handling</h2><p>Below is a series of code examples that use the <code class="language-text">try/catch/finally</code> blocks to illustrate how they work and differ from one another. Understanding how they work together can be a little tricky, so if your interested take your time to understand each in turn.</p><p>The <code class="language-text">finally</code> block will always run, for example:</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// no error</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>No errors are thrown, finally will run</em></p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>Throw an error in try, finally will run</em></p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// no error</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>Throw an error in try but not in catch, finally will run</em></p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>Throw an error in try and an error in catch, finally will run</em></p><p>Now we know <code class="language-text">finally</code> will always run even if we do not throw an error, but function execution may not always continue, for example;</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// no error</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will run&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>No errors are thrown, function execution continues</em></p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will NOT run&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>Throw an error in try, function execution stops</em></p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// no error</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will run&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>Throw an error in try but not in catch, function execution continues</em></p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will NOT run&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span></code></pre></div><p><em>Throw an error in try and in catch, function execution stops</em></p><p>So function execution will continue only if there are no errors, or if we have a <code class="language-text">catch</code> block that does not throw any errors.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">try</span> <span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;WOAH! there was an error&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will always run&#x27;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#x27;this will run&#x27;</span><span class="token punctuation">)</span></code></pre></div><p>One final little thing I wanted to highlight about the <code class="language-text">try/catch/finally</code> logic is that if we introduce some asynchronous code exection here we essentially break out of the <code class="language-text">try/catch/finally</code> entirely. In the above example the <code class="language-text">alert()</code> call is ignored and the error thrown in the <code class="language-text">try</code> section will be output to the console.</p><p>This is because the <code class="language-text">setTimeout()</code> function will branch the process exection and will just continue on as normal hitting the <code class="language-text">finally</code> section and beyond. Then when the timeout delay is up the browser will be hit with this error out of nowhere and it won’t know what to do with it. So be careful with asynchronous code execution in <code class="language-text">try/catch/finally</code> blocks.</p><h2>The solution</h2><p>If we take this learning now, and apply it to our bug described above in the “multiple search page popup” component, we can implement a very basic solution. This solution will search across different DOM locations and HTML structures until we find our selected option.</p><div class="gatsby-highlight" data-language="javascript"><pre class="language-javascript"><code class="language-javascript">document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">&#x27;#link&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&#x27;click&#x27;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token keyword">null</span>
  <span class="token keyword">const</span> container <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>parentNode
  <span class="token comment">// find the selected option</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// location 1</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> selectElement <span class="token operator">=</span> container<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
      value <span class="token operator">=</span> selectElement<span class="token punctuation">.</span>options<span class="token punctuation">[</span>selectElement<span class="token punctuation">.</span>selectedIndex<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do nothing</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// location 2</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> selectElement <span class="token operator">=</span> container<span class="token punctuation">.</span>childNodes<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
      value <span class="token operator">=</span> selectElement<span class="token punctuation">.</span>options<span class="token punctuation">[</span>selectElement<span class="token punctuation">.</span>selectedIndex<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do nothing</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// location 3</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> hiddenInputElement <span class="token operator">=</span> container<span class="token punctuation">.</span>firstElementChild
      value <span class="token operator">=</span> hiddenInputElement<span class="token punctuation">.</span>value
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// do nothing</span>
  <span class="token punctuation">}</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span></code></pre></div><p><em>Each time we query the DOM we do it inside of a try/catch block</em></p><p>In the above code snippet we look for a “select” element in our containers child nodes collection at index <code class="language-text">0</code> and <code class="language-text">1</code>. Failing this we then grab the first child element of the container and extract it’s value. This covers all known variants of our “multiple search page popup” component, using both the “select” element and a “list box” component.</p><p>Remember in the first version of this component a “select” element is used to implement the dropdown. With a “select” element we can query the elements <code class="language-text">options</code> attribute and grab the entry at the selected index.</p><p>But in our new version of the component a “list box” component uses a bunch of <code class="language-text">div</code> elements with an <code class="language-text">input</code> element used to hold the selected options value.</p><h2>Conclusion</h2><p>In this post I talked about a bug in a component I encountered recently that made me think a little harder about how the try/catch/finally blocks worked. At first I misunderstood when a functions execution would continue under certain error conditions, but as I explored a little deeper things became more clear.</p><p>When you need to query the DOM in multiple locations within a single function call then maybe the solution presented here is “good enough”. But I’m sure there are better ways to handle this type of scenario. I would have preferred to isolate the logic for each variant of the “multiple search page popup” component to avoid having one function check multiple use cases, but there was potential here to impact the wider system so it was avoided.</p><p>Working on this bug has reminded me that having a comprehensive set of unit and integration tests ensuring system stability as you refactor code is extremely valuable. Tests give you confidence that your changes are not negatively impacting the wider system, but only if you have quality tests. Badly written tests can give developers false positives, but I think some bad tests are still better than no tests at all.</p><p>So write some tests! if not for you, then do it for future you, or me.</p><h2>References</h2><ul><li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/try...catch" target="_blank" rel="noreferrer noopener">MDN try…catch</a></li></ul><h2>Share this post</h2><div><button aria-label="linkedin" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="48" height="48"><circle cx="32" cy="32" r="31" fill="#007fb1"></circle><path d="M20.4,44h5.4V26.6h-5.4V44z M23.1,18c-1.7,0-3.1,1.4-3.1,3.1c0,1.7,1.4,3.1,3.1,3.1 c1.7,0,3.1-1.4,3.1-3.1C26.2,19.4,24.8,18,23.1,18z M39.5,26.2c-2.6,0-4.4,1.4-5.1,2.8h-0.1v-2.4h-5.2V44h5.4v-8.6 c0-2.3,0.4-4.5,3.2-4.5c2.8,0,2.8,2.6,2.8,4.6V44H46v-9.5C46,29.8,45,26.2,39.5,26.2z" fill="white"></path></svg></button><button aria-label="email" class="react-share__ShareButton" style="background-color:transparent;border:none;padding:0;font:inherit;color:inherit;cursor:pointer"><svg viewBox="0 0 64 64" width="48" height="48"><circle cx="32" cy="32" r="31" fill="#7f7f7f"></circle><path d="M17,22v20h30V22H17z M41.1,25L32,32.1L22.9,25H41.1z M20,39V26.6l12,9.3l12-9.3V39H20z" fill="white"></path></svg></button></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-63312977-12', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/blog/javascript-try-catch-finally-error-handling/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c38cd845a4181427323c.js"],"app":["/app-515c1d2f645bea33d60b.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-b0556ce5127c1a3e2490.js"],"component---src-pages-404-js":["/component---src-pages-404-js-c10d5c8bf6e48b1a78ac.js"],"component---src-pages-index-js":["/component---src-pages-index-js-2da69e0e831592d55f7c.js"],"component---src-templates-post-template-js":["/component---src-templates-post-template-js-bae8dc2dc1ce16295dd3.js"]};/*]]>*/</script><script src="/polyfill-c38cd845a4181427323c.js" nomodule=""></script><script src="/component---src-templates-post-template-js-bae8dc2dc1ce16295dd3.js" async=""></script><script src="/efb843684f5d054a3f031beebf163da3acfe6ec8-4c9ed97c0d4c26600394.js" async=""></script><script src="/b79069689330af6ebec416d0224ba4ba1c9f1d46-54feeece3a0d49a7f66e.js" async=""></script><script src="/app-515c1d2f645bea33d60b.js" async=""></script><script src="/styles-755093da0c07f4b49226.js" async=""></script><script src="/framework-8e528b732ab2eaadb7b7.js" async=""></script><script src="/webpack-runtime-7bf8aac40dc11a90f17f.js" async=""></script></body></html>